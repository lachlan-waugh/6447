<!doctype html><html lang=en><head><meta charset=utf-8><title>5: programming errors/fuzzing</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-16805>We&rsquo;ll get started at 1[68]:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=fuzzing--programming-errors>fuzzing & programming errors</h1><h3 id=6447-week5>6447 week5</h3></section><section><h2 id=good-faith-policy>Good faith policy</h2><p>We expect a high standard of professionalism from you at all times while you are taking any of our courses. We expect all students to act in good faith at all times</p><p><em>TLDR: don&rsquo;t be a <del>dick</del> jerk</em></p><p><a href=https://sec.edu.au/good-faith-policy>sec.edu.au/good-faith-policy</a></p></section><section><section data-shortcode-section><h2 id=fuzzer-group-project>Fuzzer (Group Project)</h2><ul><li>[<a href=https://webcms3.cse.unsw.edu.au/COMP6447/23T3/resources/92851>Major Project</a>] on WebCMS</li></ul></section><section><h3 id=okay>okay</h3><blockquote><p>ramble about fuzzers</p></blockquote></section><section><h3 id=due-dates>due dates</h3><ul><li><em>midpoint</em>: end of week07</li><li><em>final</em>: end of week10</li></ul></section><section><h3 id=groups>Groups</h3><ul><li>register <a href=https://forms.gle/7As9vpV47JB1KSCU8>here</a> (linked on WebCMS)</li><li>each group, just email me whos in your group</li><li>cross-tutorial groups are fine</li></ul></section></section><section><h2 id=wargame-marks-so-far>wargame marks so far</h2><table><thead><tr><th></th><th><code>avg</code></th><th><code>3/3</code></th></tr></thead><tbody><tr><td><code>war01</code></td><td><code>2.50</code></td><td><code>18</code></td></tr><tr><td><code>war02</code></td><td><code>2.25</code></td><td><code>??</code></td></tr><tr><td><code>war03</code></td><td><code>1.80</code></td><td><code>??</code></td></tr><tr><td><code>total</code></td><td><code>6.55</code></td><td><code>??</code></td></tr></tbody></table></section><section><h1 id=source-code-auditing>source Code Auditing</h1></section><section><h3 id=what-do-these-code-blocks-do>what do these code blocks do?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>    <span style=color:#66d9ef>int</span> flags <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (flags <span style=color:#f92672>&amp;</span> FLAG){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;TRUE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;FALSE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><span class=fragment><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (flags <span style=color:#f92672>&amp;</span> FLAG <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;TRUE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;FALSE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></span><span class=fragment><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (flags <span style=color:#f92672>&amp;</span> (FLAG <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;TRUE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;FALSE</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></span></section><section><h3 id=is-this-code-the-same>is this code the same?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>flags <span style=color:#f92672>=</span> flags <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Flags: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,flags);
</span></span></code></pre></div><p>Â </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>flags <span style=color:#f92672>=</span> flags<span style=color:#f92672>++</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Flags: %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,flags);
</span></span></code></pre></div></section><section><section data-shortcode-section><h3 id=where-vuln>where vuln?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> pt[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;THISISSOMEDATAOFSOMESORT&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> env_script_name[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;USER_CONTROLLED_ENV1&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> env_path_info[] <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;USER_CONTROLLED_ENV2&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> ptlen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(pt) <span style=color:#f92672>-</span> <span style=color:#a6e22e>strlen</span>(env_script_name);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> path_translated_len <span style=color:#f92672>=</span> ptlen <span style=color:#f92672>+</span> env_path_info
</span></span><span style=display:flex><span>                          <span style=color:#f92672>?</span> <span style=color:#a6e22e>strlen</span>(env_path_info) <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>path_translated <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span>path_translated <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>) <span style=color:#a6e22e>malloc</span>(path_translated_len <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>memcpy</span>(path_translated, pt, ptlen);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (env_path_info) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>memcpy</span>(path_translated <span style=color:#f92672>+</span> ptlen, env_path_info,
</span></span><span style=display:flex><span>           path_translated_len <span style=color:#f92672>-</span> ptlen);
</span></span></code></pre></div></section><section><h3 id=its-here>it&rsquo;s here</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>//                        vvvvvvvvvvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> path_translated_len <span style=color:#f92672>=</span> ptlen <span style=color:#f92672>+</span> env_path_info
</span></span><span style=display:flex><span>                          <span style=color:#f92672>?</span> <span style=color:#a6e22e>strlen</span>(env_path_info) <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>//                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>path_translated <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>) <span style=color:#a6e22e>malloc</span>(path_translated_len <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>memcpy</span>(path_translated, pt, ptlen);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (env_path_info) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>memcpy</span>(path_translated <span style=color:#f92672>+</span> ptlen, env_path_info,
</span></span><span style=display:flex><span><span style=color:#75715e>//         vvvvvvvvvvvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>           path_translated_len <span style=color:#f92672>-</span> ptlen);
</span></span><span style=display:flex><span><span style=color:#75715e>//         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</span></span></span></code></pre></div></section><section><h3 id=the-problem>The problem?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>ptlen <span style=color:#f92672>+</span> env_path_info <span style=color:#f92672>?</span> <span style=color:#a6e22e>strlen</span>(env_path_info) <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// is not the same as
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>ptlen <span style=color:#f92672>+</span> (env_path_info <span style=color:#f92672>?</span> <span style=color:#a6e22e>strlen</span>(env_path_info) <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>);
</span></span></code></pre></div></section><section><h3 id=what-they-wanted>what they wanted</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span>(env_path_info) {
</span></span><span style=display:flex><span>    path_translated_len <span style=color:#f92672>=</span> ptlen <span style=color:#f92672>+</span> <span style=color:#a6e22e>strlen</span>(env_path_info);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    path_translated_len <span style=color:#f92672>=</span> ptlen;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=what-they-got>what they got</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> (ptlen <span style=color:#f92672>+</span> env_path_info){
</span></span><span style=display:flex><span>    path_translated_len <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(env_path_info);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    path_translated_len <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><blockquote><p>$ man mmap</p></blockquote></section></section><section><section data-shortcode-section><h3 id=what-is-the-issue-here>What is the issue here?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> (x <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (y <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#a6e22e>error</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> y;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fclose</span>(<span style=color:#f92672>&amp;</span>z);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=what-they-wanted>what they wanted</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> (x <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (y <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#a6e22e>error</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> y;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fclose</span>(<span style=color:#f92672>&amp;</span>z);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=what-they-got>what they got</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> (x <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (y <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>error</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        z <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> y;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fclose</span>(<span style=color:#f92672>&amp;</span>z);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h2 id=order-of-operations>Order of operations</h2><blockquote><p>which one is calculated first?</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>a <span style=color:#f92672>+</span> b <span style=color:#f92672>*</span> c
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> a <span style=color:#f92672>+</span> (b <span style=color:#f92672>*</span> c)
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> (a <span style=color:#f92672>+</span> b) <span style=color:#f92672>*</span> c
</span></span></code></pre></div></section><section><h3 id=this-is-good->This is good :)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>if</span> (count <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> sum<span style=color:#f92672>/</span>count <span style=color:#f92672>&lt;</span> smallaverage)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;average &lt; %g</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,smallaverage);
</span></span></code></pre></div><p>Â </p><h3 id=this-not-so-much>This, not so much</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (i <span style=color:#f92672>&lt;</span> n)
</span></span><span style=display:flex><span>    y[i] <span style=color:#f92672>=</span> x[i<span style=color:#f92672>++</span>];
</span></span></code></pre></div><blockquote><p>but why?</p></blockquote></section></section><section><section data-shortcode-section><h3 id=why-is-this-bad>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>u_int strLen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(userinput);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> buffsize <span style=color:#f92672>=</span> strLen <span style=color:#f92672>+</span> <span style=color:#ae81ff>11</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>mem <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(buffsize);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem,<span style=color:#e6db74>&#34;this/path/&#34;</span>,<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem[<span style=color:#ae81ff>10</span>],userinput,strLen);
</span></span></code></pre></div></section><section><h3 id=why-is-this-bad-1>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>u_int strLen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(userinput);
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> buffsize <span style=color:#f92672>=</span> strLen <span style=color:#f92672>+</span> <span style=color:#ae81ff>11</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>mem <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(buffsize);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem,<span style=color:#e6db74>&#34;this/path/&#34;</span>,<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem[<span style=color:#ae81ff>10</span>],userinput,strLen);
</span></span></code></pre></div><blockquote><p>its an integer overflow</p></blockquote></section><section><h2 id=its-here>it&rsquo;s here</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>u_int strLen <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(userinput);
</span></span><span style=display:flex><span><span style=color:#75715e>//vvvvvvvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> buffsize <span style=color:#f92672>=</span> strLen <span style=color:#f92672>+</span> <span style=color:#ae81ff>11</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>//^^^^^^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>mem <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(buffsize);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem,<span style=color:#e6db74>&#34;this/path/&#34;</span>,<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(mem[<span style=color:#ae81ff>10</span>],userinput,strLen);
</span></span></code></pre></div><p>what if user input is super long, (e.g. INT_MAX?)</p></section></section><section><h2 id=format-strings>format strings</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var;
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(var);
</span></span><span style=display:flex><span><span style=color:#a6e22e>fprintf</span>(stderr,var);
</span></span><span style=display:flex><span><span style=color:#a6e22e>vsnprintf</span>(var2, <span style=color:#a6e22e>strlen</span>(var2), var);
</span></span><span style=display:flex><span><span style=color:#75715e>// etc...
</span></span></span></code></pre></div><blockquote><p>I hope you recognise these lol</p></blockquote></section><section><h2 id=heap>Heap</h2><section data-shortcode-section><h3 id=why-is-this-bad>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, var);
</span></span></code></pre></div></section><section><h3 id=why-is-this-bad-1>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, var);
</span></span></code></pre></div><blockquote><p>use-after-free</p></blockquote></section><section><h3 id=why-is-this-bad-2>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var2 <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span></code></pre></div></section><section><h3 id=why-is-this-bad-3>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var2 <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>free</span>(var);
</span></span></code></pre></div><blockquote><p>double-free</p></blockquote></section></section><section><section data-shortcode-section><h3 id=why-is-this-bad>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a;
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> b[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;string&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>strcpy</span>(a, b);
</span></span></code></pre></div></section><section><h3 id=why-is-this-bad-1>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a;
</span></span><span style=display:flex><span>a <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> b[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;string&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>strcpy</span>(a, b);
</span></span></code></pre></div><blockquote><p>null pointer dereferences</p></blockquote></section><section><h3 id=how-about-this>how about this?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>a, b[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;string&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// vuln_syscall_sets_a_NULL
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Lets map NULL pointer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>mem <span style=color:#f92672>=</span> <span style=color:#a6e22e>mmap</span>(NULL, <span style=color:#ae81ff>0x1000</span>, PROT READ <span style=color:#f92672>|</span> PROT WRITE <span style=color:#f92672>|</span> PROT EXEC,
</span></span><span style=display:flex><span>           MAP FIXED <span style=color:#f92672>|</span> MAP ANONYMOUS <span style=color:#f92672>|</span> MAP PRIVATE, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (mem <span style=color:#f92672>!=</span> NULL)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fatal</span>(<span style=color:#e6db74>&#34;[-] UNABLE TO MAP ZERO PAGE!&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fprintf</span>(stdout, <span style=color:#e6db74>&#34;[+] MAPPED ZERO PAGE!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>strcpy</span>(a, b);
</span></span><span style=display:flex><span><span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;%s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,a);
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=why-is-this-bad>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(var <span style=color:#f92672>==</span> NULL) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>10</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    var[i] <span style=color:#f92672>=</span> argv[<span style=color:#ae81ff>2</span>][i];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=why-is-this-bad-1>why is this bad?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>//          vvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//          ^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(var <span style=color:#f92672>==</span> NULL) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//             vvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>10</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span><span style=color:#75715e>//             ^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    var[i] <span style=color:#f92672>=</span> argv[<span style=color:#ae81ff>2</span>][i];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>off-by-one</p></blockquote></section><section><h2 id=the-problem>The problem</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>var <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//          ^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(var <span style=color:#f92672>==</span> NULL) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>10</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span><span style=color:#75715e>//             ^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    var[i] <span style=color:#f92672>=</span> argv[<span style=color:#ae81ff>2</span>][i];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><h2 id=tutorial>Tutorial</h2><blockquote><p>find the vulns <a href=https://waugh.zip/6447/demos/src>here</a></p></blockquote><ul><li>consider the impact of the vulns</li></ul></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>